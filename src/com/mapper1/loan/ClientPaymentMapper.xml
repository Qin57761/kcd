<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mapper1.loan.ClientPaymentMapper">

    
<!--查询全部数据 -->
<select id="selectPayList" parameterType="pd" resultType="pd">
SELECT
	*,
	bc.id,
	bc.c_name,
	kk.dk_price,
	kk.dk_total_price,
	kk.gems_code,
	aa.icbc_pricecs,
	kk.aj_date,
	kk.dt_edit,
	bc.c_cardno,
	bc.loan_tpid,
	kk.dk_lv 
FROM
	(SELECT * FROM icbc_erp_kj_icbc_result WHERE STATUS = 61 ORDER BY dt_edit DESC) AS a 
LEFT JOIN kj_icbc bc ON bc.id=a.icbc_id
LEFT JOIN kjs_icbc_kk kk ON kk.icbc_id=a.icbc_id
LEFT JOIN assess_cars aa ON aa.icbc_id=a.icbc_id
where 1=1
<if test="param != null and param != ''">
	 and bc.c_name like '%${param}%' or bc.c_cardno like '%${param}%'
</if>
GROUP BY a.qryid
ORDER BY a.dt_edit DESC
</select>    
    
    
<!-- 用户放款成功，生成还款计划 -->
<insert id="addPaySchedule"  parameterType="pd" keyProperty="id" useGeneratedKeys="true">
insert into loan_repayment_schedule(
dt_add,
dt_edit,
should_date,
should_money,
icbc_id,
c_cardno,
c_name
) values(
sysdate(),
sysdate(),
#{should_date},
#{should_money},
#{icbc_id},
#{c_cardno},
#{c_name}
)
</insert>   
    
</mapper>