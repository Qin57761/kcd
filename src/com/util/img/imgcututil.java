package com.util.img;


import java.awt.Color; 
import java.awt.Graphics; 
import java.awt.Graphics2D; 
import java.awt.Image; 
import java.awt.Toolkit; 
import java.awt.geom.AffineTransform; 
import java.awt.image.AffineTransformOp; 
import java.awt.image.BufferedImage; 
import java.awt.image.CropImageFilter; 
import java.awt.image.FilteredImageSource; 
import java.awt.image.ImageFilter; 
import java.io.File; 
import java.io.IOException; 
import java.text.SimpleDateFormat; 
import java.util.Date; 
  
import javax.imageio.ImageIO; 
  
public class imgcututil { 
	
	/**
	 * 是否为图片
	 * @param file
	 * @return
	 */
    public static boolean isImage(File file){  
        if(file.isDirectory()){  
            return false;  
        }  
        String fileName = file.getName();  
        int len = fileName.indexOf(".");  
        String imagesPattern  = fileName.substring(len+1,fileName.length()).toLowerCase();  
        if("jpg".equals(imagesPattern)){  
            return true;  
        }else if("bmp".equals(imagesPattern)){  
            return true;  
        }else if("gif".equals(imagesPattern)){  
            return true;  
        }else if("psd".equals(imagesPattern)){  
            return true;  
        }else if("pcx".equals(imagesPattern)){  
            return true;  
        }else if("png".equals(imagesPattern)){  
            return true;  
        }else if("dxf".equals(imagesPattern)){  
            return true;  
        }else if("cdr".equals(imagesPattern)){  
            return true;  
        }else if("ico".equals(imagesPattern)){  
            return true;  
        }else if("bmp".equals(imagesPattern)){  
            return true;  
        }else if("jpeg".equals(imagesPattern)){  
            return true;  
        }else if("svg".equals(imagesPattern)){  
            return true;  
        }else if("wmf".equals(imagesPattern)){  
            return true;  
        }else if("emf".equals(imagesPattern)){  
            return true;  
        }else if("eps".equals(imagesPattern)){  
            return true;  
        }else if("tga".equals(imagesPattern)){  
            return true;  
        }else if("nef".equals(imagesPattern)){  
            return true;  
        }else if("tif".equals(imagesPattern)){  
            return true;  
        }else if("tiff".equals(imagesPattern)){  
            return true;  
        }else{  
            return false;  
        }  
  
    }  
	
   /** 
   * 改变图片尺寸 
   * @param srcFileName 源图片路径 
   * @param tagFileName 目的图片路径 
   * @param width 修改后的宽度 
   * @param height 修改后的高度 
   */
  public static void zoomImage(String srcFileName,String tagFileName,int width,int height){  
     try { 
     BufferedImage bi = ImageIO.read(new File(srcFileName)); 
     BufferedImage tag=new BufferedImage(width,height, BufferedImage.TYPE_INT_RGB); 
     tag.getGraphics().drawImage(bi, 0, 0, width, height, null); 
     ImageIO.write(tag, "jpg", new File(tagFileName));//画图 
     } catch (IOException e) { 
     e.printStackTrace(); 
     } 
  } 
    
    public static void main(String[] args) {
		
//    	String path="F:/workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp0/wtpwebapps/kcd/image/upload/img/20171102/cedea33c94a342c9a307203adf9e49c8.jpg";	 
//   	     String imgpath=path+".new.jpg";
//   	  //zoomImage(path,imgpath,800,800);
//   	 cut(imgpath,imgpath+".jpg",51,86,713,201);
    	
    	String str = "8.08";
    	double testDou = Double.parseDouble(str);
    	System.out.println((int)testDou);
    	System.out.println(str.substring(0,str.indexOf(".")));
    	int in = Integer.parseInt(str.substring(0,str.indexOf(".")));
    	System.out.println(in);
	}
    
  /** 
   * 缩放图像（按高度和宽度缩放） 
   * @param srcImageFile 源图像文件地址 
   * @param result 缩放后的图像地址 
   * @param height 缩放后的高度 
   * @param width 缩放后的宽度 
   * @param bb 比例不对时是否需要补白：true为补白; false为不补白; 
   */
  public void scale(String srcImageFile, String result, int height, int width, boolean bb) { 
    try { 
      double ratio = 0.0; // 缩放比例 
      File f = new File(srcImageFile); 
      BufferedImage bi = ImageIO.read(f); 
      Image itemp = bi.getScaledInstance(width, height, Image.SCALE_SMOOTH); 
      // 计算比例 
      if ((bi.getHeight() > height) || (bi.getWidth() > width)) { 
        if (bi.getHeight() > bi.getWidth()) { 
          ratio = (new Integer(height)).doubleValue() 
              / bi.getHeight(); 
        } else { 
          ratio = (new Integer(width)).doubleValue() / bi.getWidth(); 
        } 
        AffineTransformOp op = new AffineTransformOp(AffineTransform 
            .getScaleInstance(ratio, ratio), null); 
        itemp = op.filter(bi, null); 
      } 
      if (bb) {//补白 
        BufferedImage image = new BufferedImage(width, height, 
            BufferedImage.TYPE_INT_RGB); 
        Graphics2D g = image.createGraphics(); 
        g.setColor(Color.white); 
        g.fillRect(0, 0, width, height); 
        if (width == itemp.getWidth(null)) 
          g.drawImage(itemp, 0, (height - itemp.getHeight(null)) / 2, 
              itemp.getWidth(null), itemp.getHeight(null), 
              Color.white, null); 
        else
          g.drawImage(itemp, (width - itemp.getWidth(null)) / 2, 0, 
              itemp.getWidth(null), itemp.getHeight(null), 
              Color.white, null); 
        g.dispose(); 
        itemp = image; 
      } 
      ImageIO.write((BufferedImage) itemp, "JPEG", new File(result)); 
    } catch (IOException e) { 
      e.printStackTrace(); 
    } 
  } 
    
    
  /** 
   * 图像切割(按指定起点坐标和宽高切割) 
   * @param srcImageFile 源图像地址 
   * @param result 切片后的图像地址 
   * @param x 目标切片起点坐标X 
   * @param y 目标切片起点坐标Y 
   * @param width 目标切片宽度 
   * @param height 目标切片高度 
   */
  public static void cut(String srcImageFile, String result, 
      int x, int y, int width, int height) { 
    try { 
      // 读取源图像 
      BufferedImage bi = ImageIO.read(new File(srcImageFile)); 
      int srcWidth = bi.getHeight(); // 源图宽度 
      int srcHeight = bi.getWidth(); // 源图高度 
      if (srcWidth > 0 && srcHeight > 0) { 
        Image image = bi.getScaledInstance(srcWidth, srcHeight, 
            Image.SCALE_DEFAULT); 
        // 四个参数分别为图像起点坐标和宽高 
        // 即: CropImageFilter(int x,int y,int width,int height) 
        ImageFilter cropFilter = new CropImageFilter(x, y, width, height); 
        Image img = Toolkit.getDefaultToolkit().createImage( 
            new FilteredImageSource(image.getSource(), 
                cropFilter)); 
        BufferedImage tag = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB); 
        Graphics g = tag.getGraphics(); 
        g.drawImage(img, 0, 0, width, height, null); // 绘制切割后的图 
        g.dispose(); 
        // 输出为文件 
        ImageIO.write(tag, "JPEG", new File(result)); 
      } 
    } catch (Exception e) { 
      e.printStackTrace(); 
    } 
  } 
//  //获得文件名字 
//  public String getFileName(MultipartFile file, HttpServletRequest request,HttpSession session){ 
//    String FILE_PATH = session.getServletContext().getRealPath("/") + "upload"; 
//    String fileName = file.getOriginalFilename();  
//    String[] suffixNameArr = fileName.split("\\."); 
//    String suffixName = suffixNameArr[suffixNameArr.length-1]; 
//    String userName = SecurityContextHolder.getContext().getAuthentication().getName(); 
//      
//    return getTime() + userName+"."+suffixName; 
//  } 
  //文件上传,返回文件路径 
//  public String uploadFile(MultipartFile file, HttpServletRequest request,HttpSession session) throws IOException { 
//    String FILE_PATH = session.getServletContext().getRealPath("/") + "upload"; 
//    String fileName = getFileName(file,request,session); 
//    File tempFile = new File(FILE_PATH, fileName);  
//      
//    if (!tempFile.getParentFile().exists()) {  
//      tempFile.getParentFile().mkdir();  
//    }  
//    if (!tempFile.exists()) {  
//      tempFile.createNewFile();  
//    }  
//    file.transferTo(tempFile); //将上传文件写到服务器上指定的文件。 
//      
//    return FILE_PATH + "\\" + tempFile.getName();  
//  }  
   
  /* public static File getFile(String fileName) {  
    return new File(FILE_PATH, fileName);  
  } */ 
    
  public String getTime(){ 
    Date date = new Date(); 
    SimpleDateFormat df = new SimpleDateFormat("yyyyMMddHHmmss");//设置日期格式 
    String nowTime = df.format(date).toString(); 
    return nowTime; 
  } 
} 
